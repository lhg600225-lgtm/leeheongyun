<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TOTAL SEARCH - AI ì§€ëŠ¥í˜• ê²€ìƒ‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;800&display=swap');
        body { font-family: 'Pretendard', sans-serif; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass-effect { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(12px); }
    </style>
</head>
<body class="bg-[#F8FAFC] text-slate-800">

    <div id="app" class="flex flex-col h-screen overflow-hidden">
        <!-- Header & Search Section -->
        <header class="px-5 pt-10 pb-5 bg-white shadow-sm border-b border-slate-100 z-20">
            <div class="flex items-center justify-between mb-4 leading-none">
                <div class="flex items-center gap-2">
                    <div class="bg-gradient-to-tr from-blue-600 to-cyan-400 p-1.5 rounded-xl shadow-md shadow-blue-100">
                        <i data-lucide="sparkles" class="text-white w-4 h-4"></i>
                    </div>
                    <h1 class="text-lg font-black tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-blue-700 to-blue-400 uppercase">
                        TOTAL SEARCH
                    </h1>
                </div>
                <div class="flex items-center gap-2">
                    <button class="p-2 bg-slate-50 rounded-full text-slate-400 border border-slate-100">
                        <i data-lucide="info" class="w-4 h-4"></i>
                    </button>
                </div>
            </div>
            
            <div class="relative group">
                <div class="absolute inset-y-0 left-4 flex items-center pointer-events-none text-slate-400 transition-colors group-focus-within:text-blue-500">
                    <i data-lucide="search" class="w-5 h-5"></i>
                </div>
                <input
                    id="search-input"
                    type="text"
                    class="w-full bg-slate-50 border-2 border-transparent rounded-[20px] py-4 pl-12 pr-24 text-base font-semibold placeholder:text-slate-300 focus:outline-none focus:border-blue-400 focus:ring-4 focus:ring-blue-400/5 transition-all shadow-sm"
                    placeholder="ê¶ê¸ˆí•œ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"
                />
                <div class="absolute inset-y-0 right-2 flex items-center gap-1">
                    <button id="clear-btn" class="p-2 text-slate-300 hover:text-slate-500 hidden">
                        <i data-lucide="x" class="w-5 h-5"></i>
                    </button>
                    <button 
                        id="analyze-btn"
                        class="p-2 rounded-xl transition-all text-slate-200 bg-slate-100"
                        disabled
                    >
                        <i data-lucide="arrow-right" id="btn-icon" class="w-5 h-5"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content Area -->
        <main id="content" class="flex-1 overflow-y-auto px-5 py-6 space-y-6 hide-scrollbar">
            <!-- Initial Welcome Content -->
            <div id="welcome-view" class="space-y-6">
                <div class="bg-gradient-to-br from-blue-600 to-indigo-700 rounded-[28px] p-6 text-white shadow-xl shadow-blue-200 relative overflow-hidden">
                    <div class="relative z-10">
                        <div class="flex items-center gap-1.5 mb-2">
                            <i data-lucide="zap" class="w-3 h-3 fill-yellow-300 text-yellow-300"></i>
                            <span class="text-[10px] font-black uppercase tracking-widest opacity-80">Powered by Gemini</span>
                        </div>
                        <h2 class="text-xl font-bold leading-tight mb-1">ì§€ëŠ¥í˜• í† íƒˆ ê²€ìƒ‰</h2>
                        <p class="text-blue-100 text-xs opacity-90 leading-snug">AI ë¶„ì„ ë¦¬í¬íŠ¸ì™€ 6ëŒ€ í”Œë«í¼ ê²€ìƒ‰ì„ í•œê³³ì—ì„œ.</p>
                    </div>
                    <div class="absolute -bottom-6 -right-6 opacity-10 transform -rotate-12">
                        <i data-lucide="navigation" class="w-28 h-28 text-white"></i>
                    </div>
                </div>

                <div class="space-y-3">
                    <h3 class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">ë¹ ë¥¸ ê²€ìƒ‰ ì—”ì§„</h3>
                    <div id="engine-grid" class="grid grid-cols-3 gap-2.5">
                        <!-- Engines will be rendered here -->
                    </div>
                </div>
            </div>

            <!-- Loading View -->
            <div id="loading-view" class="hidden flex flex-col items-center justify-center py-20 space-y-5">
                <div class="relative">
                    <div class="absolute inset-0 bg-blue-400 rounded-full blur-2xl opacity-10 animate-pulse"></div>
                    <i data-lucide="loader-2" class="w-10 h-10 text-blue-500 animate-spin relative z-10"></i>
                </div>
                <div class="text-center">
                    <p class="text-slate-800 font-bold text-base tracking-tight">AIê°€ ìµœì‹  ì •ë³´ë¥¼ ë¶„ì„í•˜ê³  ìˆì–´ìš”</p>
                    <p class="text-slate-400 text-[11px] mt-1 font-medium">ì¸í¬ê·¸ë˜í”½ ë¦¬í¬íŠ¸ ìƒì„± ì¤‘...</p>
                </div>
            </div>

            <!-- Result View -->
            <div id="result-view" class="hidden space-y-6 pb-10">
                <!-- AI Card -->
                <div class="bg-white rounded-[28px] p-6 shadow-xl shadow-blue-900/5 border border-slate-100 relative overflow-hidden">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-2">
                            <div class="w-1.5 h-6 bg-blue-600 rounded-full"></div>
                            <h3 class="text-lg font-black text-slate-800">AI ë¦¬í¬íŠ¸</h3>
                        </div>
                        <button class="text-slate-400 hover:text-blue-600 transition-colors">
                            <i data-lucide="share-2" class="w-5 h-5"></i>
                        </button>
                    </div>
                    
                    <div id="analysis-text" class="whitespace-pre-wrap text-slate-600 leading-relaxed font-medium text-[14px] mb-6">
                        <!-- Text here -->
                    </div>

                    <div id="suggestions-container" class="mt-4 pt-5 border-t border-slate-50 space-y-3 hidden">
                        <p class="text-[10px] font-black text-blue-500 uppercase flex items-center gap-1.5">
                            <i data-lucide="sparkles" class="w-3 h-3"></i> âœ¨ ì´ì–´ì§€ëŠ” ì¶”ì²œ ì§ˆë¬¸
                        </p>
                        <div id="suggestions-list" class="flex flex-col gap-2">
                            <!-- Suggestions here -->
                        </div>
                    </div>

                    <div class="mt-6 flex gap-2">
                        <button id="retry-btn" class="flex-1 bg-slate-50 text-slate-500 py-3 rounded-2xl text-xs font-bold flex items-center justify-center gap-2 active:bg-slate-100">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i> ë‹¤ì‹œ ë¶„ì„
                        </button>
                        <button class="flex-1 bg-blue-600 text-white py-3 rounded-2xl text-xs font-bold flex items-center justify-center gap-2 shadow-lg shadow-blue-200">
                            <i data-lucide="message-square" class="w-4 h-4"></i> âœ¨ ì‹¬í™” ëŒ€í™”
                        </button>
                    </div>
                </div>

                <div class="space-y-3">
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest ml-1">í”Œë«í¼ë³„ ê²°ê³¼ í™•ì¸</p>
                    <div id="platform-links" class="grid grid-cols-2 gap-2.5">
                        <!-- Links here -->
                    </div>
                </div>
            </div>

            <!-- Error View -->
            <div id="error-view" class="hidden p-5 bg-red-50 text-red-500 rounded-[24px] text-sm font-bold text-center border border-red-100">
                ì •ë³´ë¥¼ ë¶„ì„í•˜ëŠ” ì¤‘ì— ë¬¸ì œê°€ ë°œìƒí–ˆì–´ìš”.
            </div>
        </main>
    </div>

    <script>
        const apiKey = "";
        const engines = [
            { name: 'ë„¤ì´ë²„', color: '#005bac', url: 'https://search.naver.com/search.naver?query=', icon: 'N' },
            { name: 'êµ¬ê¸€', color: '#1a73e8', url: 'https://www.google.com/search?q=', icon: 'G' },
            { name: 'ë‹¤ìŒ', color: '#4a90e2', url: 'https://search.daum.net/search?q=', icon: 'D' },
            { name: 'íŠ¸ìœ„í„°', color: '#1da1f2', url: 'https://twitter.com/search?q=', icon: 'T' },
            { name: 'ìœ íŠœë¸Œ', color: '#003399', url: 'https://www.youtube.com/results?search_query=', icon: 'Y' },
            { name: 'ì¸ìŠ¤íƒ€', color: '#0077b5', url: 'https://www.instagram.com/explore/tags/', icon: 'I' }
        ];

        // DOM Elements
        const input = document.getElementById('search-input');
        const clearBtn = document.getElementById('clear-btn');
        const analyzeBtn = document.getElementById('analyze-btn');
        const btnIcon = document.getElementById('btn-icon');
        const engineGrid = document.getElementById('engine-grid');
        const platformLinks = document.getElementById('platform-links');
        
        const welcomeView = document.getElementById('welcome-view');
        const loadingView = document.getElementById('loading-view');
        const resultView = document.getElementById('result-view');
        const errorView = document.getElementById('error-view');
        
        const analysisText = document.getElementById('analysis-text');
        const suggestionsContainer = document.getElementById('suggestions-container');
        const suggestionsList = document.getElementById('suggestions-list');
        const retryBtn = document.getElementById('retry-btn');

        // Initialization
        function init() {
            lucide.createIcons();
            renderEngines();
        }

        function renderEngines() {
            engineGrid.innerHTML = engines.map(engine => `
                <button onclick="handleExternalSearch('${engine.url}')" class="flex flex-col items-center justify-center bg-white py-4 px-2 rounded-[24px] shadow-sm border border-slate-100 active:scale-95 transition-all">
                    <div class="w-11 h-11 rounded-2xl flex items-center justify-center text-white font-black text-lg mb-2 shadow-md" style="background: linear-gradient(135deg, ${engine.color}, ${engine.color}CC)">
                        ${engine.icon}
                    </div>
                    <span class="text-[10px] font-bold text-slate-600">${engine.name}</span>
                </button>
            `).join('');

            platformLinks.innerHTML = engines.slice(0, 4).map(engine => `
                <button onclick="handleExternalSearch('${engine.url}')" class="flex items-center gap-3 bg-white p-3.5 rounded-[20px] border border-slate-100 shadow-sm active:bg-blue-50 transition-colors">
                    <div class="w-8 h-8 rounded-lg flex items-center justify-center text-white text-[11px] font-black shadow-sm" style="background-color: ${engine.color}">
                        ${engine.icon}
                    </div>
                    <span class="text-[11px] font-bold text-slate-500">${engine.name} ê²€ìƒ‰</span>
                    <i data-lucide="external-link" class="w-3 h-3 ml-auto text-slate-300"></i>
                </button>
            `).join('');
            lucide.createIcons();
        }

        function handleExternalSearch(baseUrl) {
            const query = input.value.trim();
            if (!query) {
                input.focus();
                return;
            }
            window.open(`${baseUrl}${encodeURIComponent(query)}`, '_blank');
        }

        async function callGemini(prompt, systemInstruction, retryCount = 0) {
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: systemInstruction }] }
            };

            try {
                const response = await fetch(
                    `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
                    {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    }
                );

                if (!response.ok) throw new Error('API request failed');
                const result = await response.json();
                return result.candidates?.[0]?.content?.parts?.[0]?.text;
            } catch (err) {
                if (retryCount < 5) {
                    const delay = Math.pow(2, retryCount) * 1000;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    return callGemini(prompt, systemInstruction, retryCount + 1);
                }
                throw err;
            }
        }

        async function getAIAnalysis() {
            const query = input.value.trim();
            if (!query) return;

            // UI State Change
            welcomeView.classList.add('hidden');
            resultView.classList.add('hidden');
            errorView.classList.add('hidden');
            loadingView.classList.remove('hidden');
            analyzeBtn.disabled = true;
            
            const mainSystemPrompt = `ë‹¹ì‹ ì€ ì „ë¬¸ ì •ë³´ ë¶„ì„ê°€ì…ë‹ˆë‹¤. ê²€ìƒ‰ì–´ "${query}"ì— ëŒ€í•´ ë‹¤ìŒ í˜•ì‹ì„ ì§€ì¼œ ë‹µë³€í•˜ì„¸ìš”.
            1. âœ¨ í•µì‹¬ í•œ ì¤„ ì •ì˜
            2. ğŸ’ ì£¼ìš” íŠ¹ì§• (3ê°€ì§€ ë¶ˆë ›í¬ì¸íŠ¸)
            3. ğŸš€ ìµœì‹  íŠ¸ë Œë“œì™€ ì´ìŠˆ
            4. ğŸ”— ì¶”ì²œ ì—°ê´€ í‚¤ì›Œë“œ (3ê°€ì§€)
            ë§¤ìš° ì‚°ëœ»í•˜ê³  ì •ì¤‘í•œ í•œêµ­ì–´ë¡œ ì‘ì„±í•˜ì„¸ìš”.`;

            const suggestionSystemPrompt = `ì‚¬ìš©ìê°€ "${query}"ì— ëŒ€í•´ ê²€ìƒ‰í–ˆìŠµë‹ˆë‹¤. ì´ ì£¼ì œì™€ ê´€ë ¨í•˜ì—¬ ì‚¬ìš©ìê°€ ê¶ê¸ˆí•´í• ë§Œí•œ 'ë‹¤ìŒ ì§ˆë¬¸' 3ê°€ì§€ë¥¼ ì§§ì€ ë¬¸ì¥ í˜•íƒœë¡œ ì¶”ì²œí•´ì£¼ì„¸ìš”. 
            JSON í˜•ì‹ì´ ì•„ë‹Œ, ê° ì§ˆë¬¸ì„ ì¤„ë°”ê¿ˆìœ¼ë¡œë§Œ êµ¬ë¶„í•´ì„œ ë³´ë‚´ì£¼ì„¸ìš”.`;

            try {
                const [mainText, suggestionText] = await Promise.all([
                    callGemini(query, mainSystemPrompt),
                    callGemini(`"${query}"ì— ëŒ€í•œ ë‹¤ìŒ ì§ˆë¬¸ ì¶”ì²œ`, suggestionSystemPrompt)
                ]);

                analysisText.innerText = mainText;
                
                if (suggestionText) {
                    const suggestions = suggestionText.split('\n').filter(s => s.trim().length > 0).slice(0, 3);
                    suggestionsList.innerHTML = suggestions.map(s => `
                        <button onclick="performQuickSearch('${s.replace(/'/g, "\\'")}')" class="text-left bg-blue-50/50 hover:bg-blue-50 border border-blue-100/50 px-4 py-3 rounded-2xl text-[13px] text-blue-700 font-semibold transition-all flex items-center justify-between group">
                            ${s}
                            <i data-lucide="chevron-right" class="w-4 h-4 opacity-0 group-hover:opacity-100 transition-opacity"></i>
                        </button>
                    `).join('');
                    suggestionsContainer.classList.remove('hidden');
                    lucide.createIcons();
                }

                loadingView.classList.add('hidden');
                resultView.classList.remove('hidden');
            } catch (err) {
                loadingView.classList.add('hidden');
                errorView.classList.remove('hidden');
            } finally {
                analyzeBtn.disabled = false;
            }
        }

        window.performQuickSearch = function(q) {
            input.value = q;
            updateInputState();
            getAIAnalysis();
        };

        function updateInputState() {
            const val = input.value.trim();
            clearBtn.classList.toggle('hidden', !val);
            analyzeBtn.classList.toggle('bg-blue-600', !!val);
            analyzeBtn.classList.toggle('text-white', !!val);
            analyzeBtn.classList.toggle('bg-slate-100', !val);
            analyzeBtn.classList.toggle('text-slate-200', !val);
            analyzeBtn.disabled = !val;
        }

        // Event Listeners
        input.addEventListener('input', updateInputState);
        clearBtn.addEventListener('click', () => {
            input.value = '';
            welcomeView.classList.remove('hidden');
            resultView.classList.add('hidden');
            loadingView.classList.add('hidden');
            errorView.classList.add('hidden');
            updateInputState();
            input.focus();
        });
        analyzeBtn.addEventListener('click', getAIAnalysis);
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                getAIAnalysis();
                input.blur();
            }
        });
        retryBtn.addEventListener('click', getAIAnalysis);

        // Start
        window.onload = init;
    </script>
</body>
</html>